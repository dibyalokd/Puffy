import org.apache.poi.ss.usermodel.*;
import java.io.File;
import java.util.*;

public class ExcelDuplicateTracker {

    public static void main(String[] args) {
        File folder = new File("path/to/your/excel/files");
        // Map: CaseID -> List of "FileName : SheetName"
        Map<String, List<String>> caseMap = new HashMap<>();

        File[] files = folder.listFiles((dir, name) -> name.endsWith(".xlsx") || name.endsWith(".xls"));

        if (files == null) return;

        for (File file : files) {
            try (Workbook workbook = WorkbookFactory.create(file)) {
                for (int i = 0; i < workbook.getNumberOfSheets(); i++) {
                    Sheet sheet = workbook.getSheetAt(i);
                    processSheet(sheet, file.getName(), caseMap);
                }
            } catch (Exception e) {
                System.err.println("Error reading " + file.getName() + ": " + e.getMessage());
            }
        }

        printDuplicates(caseMap);
    }

    private static void processSheet(Sheet sheet, String fileName, Map<String, List<String>> caseMap) {
        Row headerRow = sheet.getRow(0);
        if (headerRow == null) return;

        int caseIdColIndex = -1;
        for (Cell cell : headerRow) {
            if ("caseId".equalsIgnoreCase(cell.toString())) {
                caseIdColIndex = cell.getColumnIndex();
                break;
            }
        }

        if (caseIdColIndex == -1) return; // Column not found in this sheet

        for (int r = 1; r <= sheet.getLastRowNum(); r++) {
            Row row = sheet.getRow(r);
            if (row == null) continue;
            
            Cell cell = row.getCell(caseIdColIndex);
            if (cell != null) {
                String val = cell.toString().trim();
                if (!val.isEmpty()) {
                    String location = fileName + " [Sheet: " + sheet.getSheetName() + "]";
                    caseMap.computeIfAbsent(val, k -> new ArrayList<>()).add(location);
                }
            }
        }
    }

    private static void printDuplicates(Map<String, List<String>> caseMap) {
        System.out.println("--- Duplicate Case IDs Found ---");
        caseMap.forEach((caseId, locations) -> {
            if (locations.size() > 1) {
                System.out.println("Case ID: " + caseId);
                locations.forEach(loc -> System.out.println("  - " + loc));
            }
        });
    }
}
